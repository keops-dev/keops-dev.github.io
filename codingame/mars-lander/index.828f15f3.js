const t=document.getElementById("timer_value"),e=document.getElementById("best_score_value"),s=document.getElementById("best_state_value");class i{height=2999;width=6999;constructor(){this.marsBg=document.getElementById("mars_bg"),this.animation=document.getElementById("animation"),this.marsBgContext=this.marsBg.getContext("2d"),this.animationContext=this.animation.getContext("2d"),this.scaleFactor=this.marsBg.clientWidth/this.width,this.drawLander=this.drawLander.bind(this)}clear(){this.animationContext.clearRect(0,0,6999,2999)}draw(t){window.requestAnimationFrame((()=>this.drawLander(t)))}drawGround(t){this.marsBgContext.save(),this.marsBgContext.translate(0,2999),this.marsBgContext.scale(1,-1),this.marsBgContext.beginPath(),this.marsBgContext.moveTo(0,0),this.marsBgContext.lineTo(0,t[0].y);for(const e of t)this.marsBgContext.lineTo(e.x,e.y);this.marsBgContext.lineTo(6999,0),this.marsBgContext.fillStyle="rgb(146, 53, 53)",this.marsBgContext.fill(),this.marsBgContext.restore()}drawLander(t){if(null==t)return void console.error("Aucun jeu à dessiner");const e=t.lander,s=t.result;this.animationContext?.save(),this.animationContext?.translate(0,2999),this.animationContext?.scale(1,-1),this.animationContext.beginPath(),this.animationContext.moveTo(e.positions[0].x,e.positions[0].y);for(let t=0;t<e.positions.length;t++){const i=e.positions[t];t===e.positions.length-1&&(this.animationContext.fillStyle="rgb(255, 255, 255)","win"===s&&(this.animationContext.fillStyle="rgb(0, 255, 0)"),"crash"===s&&(this.animationContext.fillStyle="rgb(255,0,0)"),"onlanding"===s&&(this.animationContext.fillStyle="rgb(0,191,255)"),this.animationContext?.fillRect(Math.round(i.x)-20,Math.round(i.y)-20,40,40)),this.animationContext.fillStyle="rgb(255, 0, 0)","win"===s&&(this.animationContext.fillStyle="rgb(255, 255, 255)"),this.animationContext.lineTo(Math.round(i.x),Math.round(i.y))}this.animationContext.lineWidth=5,this.animationContext.stroke(),this.animationContext?.restore()}updateInfoFrame(i,n,a){t.textContent=i.toString(),e.textContent=n.toString(),s.textContent=a}}class n{simulationUI=new i;playing=!1;score=0;distanceToLandingArea=0;timer=0;constructor(t,e,s){this.surfaces=s,this.commands=e,this.ground=[{x:0,y:0},...s,{x:6999,y:0}],this.lander=t,this.landingArea=this.findLandingArea()}distanceTo(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}calculateScore(t){const e=Math.sqrt(57980002),s={x:this.landingArea[0].x/2+this.landingArea[1].x/2,y:this.landingArea[0].y};if(this.distanceToLandingArea=this.distanceTo(this.lander.pos,s),t)this.score=100-100*this.distanceToLandingArea/e;else if(this.lander.vSpeed<-40||Math.abs(this.lander.hSpeed)>20){let t=0,e=0,s=0;if(20<Math.abs(this.lander.hSpeed)){t=Math.abs(this.lander.hSpeed);t=100-100*(1-Math.max(Math.abs(this.lander.hSpeed),0)/100)}if(this.lander.vSpeed<-40){e=100-100*(1-Math.max(Math.abs(this.lander.vSpeed),0)/140)}if(0!=this.lander.rotate){s=100-100*(1-Math.max(Math.abs(this.lander.rotate),0)/90)}const i=.5*e+.5*t;this.score=200-i}else this.score=200}stopGame(t="crash"){this.playing=!1,this.result=t,this.calculateScore("crash"===t)}playGame(){for(this.playing=!0;!0===this.playing;)this.doTurn()}intersectSegment(t,e,s,i){const n={x:0,y:0},a={x:0,y:0};n.x=e.x-t.x,n.y=e.y-t.y,a.x=i.x-s.x,a.y=i.y-s.y;const o=n.x*a.y-n.y*a.x;if(0===o)return;const r=-(t.x*a.y-s.x*a.y-a.x*t.y+a.x*s.y)/o;if(r<0||r>=1)return;const h=-(-n.x*t.y+n.x*s.y+n.y*t.x-n.y*s.x)/o;if(h<0||h>=1)return;return{position:{x:s.x+h*a.x,y:t.y+r*n.y},surface:[t,e]}}collision(t,e,s){const i=t.length,n=[];for(let a=0;a<i;a++){const o=t[a];let r;r=a==i-1?t[0]:t[a+1];const h=this.intersectSegment(o,r,e,s);h&&n.push(h)}return n.length%2==1?{state:!0,...n[0]}:{state:!1,position:{x:0,y:0}}}findLandingArea(){for(let t=0;t<this.surfaces.length;t++){const e=this.surfaces[t],s=this.surfaces[t+1];if(e.y===s.y)return[e,s]}return[{x:0,y:0},{x:0,y:0}]}doTurn(){const t=this.commands[this.timer];this.timer+=1;const e=Object.assign({},this.lander.pos);this.updateLander(t),this.outOfBounds(this.lander.pos)&&(this.stopGame(),console.log("Bah... il est passé où le lander ?"));const s=this.collision(this.ground,e,this.lander.pos);1==s.state&&(this.lander.pos=s.position,this.lander.positions[this.lander.positions.length-1]=s.position,JSON.stringify(this.landingArea)==JSON.stringify(s.surface)?this.lander.landedWell()?this.stopGame("win"):this.stopGame("onlanding"):this.stopGame("crash"))}outOfBounds(t){return t.x<0||t.x>6999||(t.y<0||t.y>2999)}updateLander(t){this.lander.update(t.rotate,t.power)}}const a=[0,.0174524064372836,.03489949670250108,.052335956242943966,.06975647374412523,.08715574274765836,.10452846326765346,.12186934340514749,.13917310096006547,.15643446504023092,.17364817766693041,.19080899537654492,.20791169081775923,.22495105434386514,.24192189559966767,.25881904510252074,.27563735581699916,.29237170472273677,.30901699437494745,.32556815445715676,.3420201433256688,.35836794954530016,.3746065934159122,.3907311284892737,.4067366430758004,.42261826174069944,.43837114678907746,.45399049973954686,.46947156278589086,.4848096202463371,.5000000000000001,.5150380749100544,.5299192642332049,.5446390350150272,.5591929034707468,.573576436351046,.5877852522924731,.6018150231520483,.6156614753256583,.6293203910498375,.6427876096865394,.6560590289905074,.6691306063588582,.6819983600624985,.6946583704589974,.7071067811865476,.7193398003386512,.7313537016191705,.7431448254773942,.754709580222772,.766044443118978,.7771459614569708,.7880107536067219,.7986355100472928,.8090169943749475,.8191520442889918,.8290375725550417,.838670567945424,.848048096156426,.8571673007021123,.8660254037844387,.8746197071393957,.882947592858927,.8910065241883679,.898794046299167,.9063077870366499,.9135454576426009,.9205048534524404,.9271838545667874,.9335804264972017,.9396926207859084,.9455185755993168,.9510565162951535,.9563047559630355,.9612616959383189,.9659258262890683,.9702957262759965,.9743700647852352,.9781476007338057,.981627183447664,.984807753012208,.9876883405951378,.9902680687415704,.992546151641322,.9945218953682733,.9961946980917455,.9975640502598242,.9986295347545738,.9993908270190958,.9998476951563913,1],o=[1,.9998476951563913,.9993908270190958,.9986295347545738,.9975640502598242,.9961946980917455,.9945218953682733,.992546151641322,.9902680687415704,.9876883405951378,.984807753012208,.981627183447664,.9781476007338057,.9743700647852352,.9702957262759965,.9659258262890683,.9612616959383189,.9563047559630354,.9510565162951535,.9455185755993167,.9396926207859083,.9335804264972017,.9271838545667873,.9205048534524404,.9135454576426009,.9063077870366499,.898794046299167,.8910065241883678,.8829475928589269,.8746197071393957,.8660254037844386,.8571673007021122,.8480480961564261,.8386705679454239,.8290375725550417,.8191520442889918,.8090169943749475,.7986355100472928,.7880107536067219,.7771459614569708,.766044443118978,.7547095802227719,.7431448254773942,.7313537016191705,.7193398003386511,.7071067811865475,.6946583704589973,.6819983600624985,.6691306063588582,.6560590289905073,.6427876096865393,.6293203910498375,.6156614753256583,.6018150231520483,.5877852522924731,.573576436351046,.5591929034707468,.544639035015027,.5299192642332049,.5150380749100542,.49999999999999994,.48480962024633706,.4694715627858908,.45399049973954675,.4383711467890774,.42261826174069944,.40673664307580015,.3907311284892737,.374606593415912,.35836794954530027,.3420201433256687,.3255681544571567,.3090169943749474,.2923717047227367,.27563735581699916,.25881904510252074,.24192189559966773,.22495105434386498,.20791169081775931,.1908089953765448,.17364817766693033,.15643446504023087,.13917310096006544,.12186934340514748,.10452846326765346,.08715574274765817,.0697564737441253,.05233595624294383,.03489949670250097,.01745240643728351,0];class r{pos={x:0,y:0};fuel=0;hSpeed=0;vSpeed=0;rotate=0;power=0;positions=[];hSpeeds=[];vSpeeds=[];rotates=[];constructor(t,e=0,s=0,i=1e3,n=0){this.pos=t,this.hSpeed=e,this.vSpeed=s,this.fuel=i,this.rotate=n}update(t,e){this.updateRotate(t),this.updatePower(e),this.updatePositionAndSpeed()}updateRotate(t){const e=Math.min(Math.max(t,-15),15);this.rotate!=t&&(this.rotate=Math.min(Math.max(this.rotate+e,-90),90)),this.rotates.push(this.rotate)}updatePower(t){this.power=this.power===t?this.power:this.power+(t>this.power?1:-1)}updateFuel(){}updatePositionAndSpeed(){const t=Math.abs(this.rotate),e=a[t]*this.power*(this.rotate<0?1:-1),s=o[t]*this.power,i=this.vSpeed+-3.711+s,n=this.hSpeed+e,r=this.vSpeed+.5*(-3.711+s),h=this.hSpeed+.5*e,l=this.pos.y+r,d=this.pos.x+h;this.pos.y=l,this.pos.x=d,this.positions.push({x:d,y:l}),this.vSpeed=i,this.hSpeed=n,this.hSpeeds.push(n),this.vSpeeds.push(i)}landedWell(){return 0===this.rotate&&Math.abs(this.vSpeed)<=40&&Math.abs(this.hSpeed)<=20}}let h=function*(t){const e=t;for(ligne of e)yield ligne}(["7","0 100","1000 500","1500 1500","3000 1000","4000 150","5500 150","6999 800","2500 2700 0 0 550 0 0"]);function l(){return h.next().value}const d=document.getElementById("play"),u=document.getElementById("next"),p=document.getElementById("pause"),c=document.getElementById("reset"),m=[],x=parseInt(l());for(let t=0;t<x;t++){var g=l().split(" ");const t=parseInt(g[0]),e=parseInt(g[1]);m.push({x:t,y:e})}const y=new i,f=new class{simulate=!1;turns=0;constructor(t,e=null){this.surfaces=t,e&&(this.simulationUI=e),this.simulationUI?.drawGround(this.surfaces),this.loop=this.loop.bind(this),this.handlePlay=this.handlePlay.bind(this),this.handleNext=this.handleNext.bind(this),this.handlePause=this.handlePause.bind(this),this.handleReset=this.handleReset.bind(this)}handlePlay(){this.start(2500,2700,0,0,550,0,0,!0)}handleNext(){this.start(2500,2700,0,0,550,0,0,!1)}handlePause(){this.stop()}handleReset(){this.stop(),this.population.length=0,this.turns=0,this.simulationUI.clear()}stop(){this.simulate=!1,clearInterval(this.tick)}start(t,e,s,i,n,a,o,r){if(this.landerInitialData={X:t,Y:e,hSpeed:s,vSpeed:i,fuel:n,rotate:a,power:o},!0===r)if(null!=this.simulationUI)this.simulate=!0,this.tick=setInterval(this.loop,60);else for(this.simulate=!0;!0===this.simulate;)this.loop();else this.loop()}loop(){null!=this.simulationUI&&window.requestAnimationFrame((()=>this.simulationUI.clear())),0===this.turns&&(this.population=this.createPopulation(100,100));const{games:t,isSolution:e}=this.simulateGames(this.population);!0===e&&(this.stop(),console.log("GAGNEEEEEE !!!!!! :D"));const s=this.selection(t),i=s[0];console.log("BEST GAME :",i),null!=this.simulationUI&&window.requestAnimationFrame((()=>this.simulationUI.updateInfoFrame(this.turns,s[0].score,s[0].result)));const n=this.generatePopulation(s,Math.floor(90));this.population=[...s.map((t=>this.mutate(t.commands))),...n],this.turns+=1,this.turns>2e4&&this.stop()}generatePopulation(t,e){const s=[];for(;s.length<e;){const e=Math.floor(Math.random()*t.length),i=Math.floor(Math.random()*t.length),n=t[e],a=t[i],o=this.crossOver(n,a);o.map((t=>this.mutate(t,n,a))),s.push(...o)}return s}crossOver(t,e){let s=t,i=e;Math.random()<.5&&(s=e,i=t);let n=[],a=[];const o=Math.random();for(let t=0;t<100;t++){const e=s.commands[t],r=i.commands[t],h={rotate:Math.round(o*e.rotate+(1-o)*r.rotate),power:Math.round(o*e.power+(1-o)*r.power)},l={rotate:Math.round(o*r.rotate+(1-o)*e.rotate),power:Math.round(o*r.power+(1-o)*e.power)};n.push(h),a.push(l)}return[n,a]}mutate(t,e=null,s=null){let i=1;null==e&&(i=.2);for(let e=0;e<100;e++){const s=e/100,n=.4+s+10*s*s,a=.01*Math.random()*n*i;Math.random()<a&&(t[e]=this.createGene())}return t}selection(t){const e=t.sort(((t,e)=>e.score-t.score)),s=[],i=Math.floor(10),n=e.slice(0,i);return n.forEach((t=>s.push(t))),n}createGene(){return{rotate:Math.round(15*Math.random())*(Math.random()<.5?-1:1),power:Math.round(4*Math.random())}}createChromosome(t){const e=[];for(let s=0;s<t;s++)e.push(this.createGene());return e}createPopulation(t,e){const s=[];for(let i=0;i<t;i++)s.push(this.createChromosome(e));return s}simulateGames(t){const e=[];let s=!1;for(let i=0;i<t.length;i++){const n=t[i],a=this.simulateGame(n);if(e.push(a),"win"===a.result){console.log("JEU GAGNANT",a),s=!0;break}}return{games:e,isSolution:s}}simulateGame(t){const e=new r({x:this.landerInitialData.X,y:this.landerInitialData.Y},this.landerInitialData.hSpeed,this.landerInitialData.vSpeed,this.landerInitialData.fuel,this.landerInitialData.rotate),s=new n(e,t,this.surfaces);return s.playGame(),this.simulationUI.draw(s),s}}(m,y);d.addEventListener("click",f.handlePlay),u.addEventListener("click",f.handleNext),p.addEventListener("click",f.handlePause),c.addEventListener("click",f.handleReset);let S=!0;for(;S;){g=l().split(" ");parseInt(g[0]),parseInt(g[1]),parseInt(g[2]),parseInt(g[3]),parseInt(g[4]),parseInt(g[5]),parseInt(g[6]);console.log("-20 3"),S=!1}
//# sourceMappingURL=index.828f15f3.js.map
